import Module from"../../core/Module.js";class CellPopup extends Module{constructor(t){super(t),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerColumnOption("clickPopup")}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup))}initializeColumn(t){var o=t.definition;o.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),o.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),o.headerPopup&&this.initializeColumnHeaderPopup(t),o.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),o.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup))}initializeColumnHeaderPopup(t){var o,e=t.definition.headerPopupIcon;(o=document.createElement("span")).classList.add("tabulator-header-popup-button"),e?("function"==typeof e&&(e=e(t.getComponent())),e instanceof HTMLElement?o.appendChild(e):o.innerHTML=e):o.innerHTML="&vellip;",o.addEventListener("click",(o=>{o.stopPropagation(),o.preventDefault(),this.loadPopupEvent(t.definition.headerPopup,o,t)})),t.titleElement.insertBefore(o,t.titleElement.firstChild)}loadPopupTableCellEvent(t,o,e){e._cell&&(e=e._cell),e.column.definition[t]&&this.loadPopupEvent(e.column.definition[t],o,e)}loadPopupTableColumnEvent(t,o,e){e._column&&(e=e._column),e.definition[t]&&this.loadPopupEvent(e.definition[t],o,e)}loadPopupEvent(t,o,e){var i;e._group?e=e._group:e._row&&(e=e._row),t="function"==typeof t?t.call(this.table,o,e.getComponent(),(function(t){i=t})):t,this.loadPopup(o,e,t,i)}loadPopup(t,o,e,i){var p,n,l=!(t instanceof MouseEvent);e instanceof HTMLElement?p=e:(p=document.createElement("div")).innerHTML=e,p.classList.add("tabulator-popup"),p.addEventListener("click",(t=>{t.stopPropagation()})),l||t.preventDefault(),n=this.popup(p),"function"==typeof i&&n.renderCallback(i),n.show(t).hideOnBlur((()=>{this.dispatchExternal("popupClosed",o.getComponent())})),this.dispatchExternal("popupOpened",o.getComponent())}}CellPopup.moduleName="cellpopup";export default CellPopup;
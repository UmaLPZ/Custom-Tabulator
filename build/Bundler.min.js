import{nodeResolve}from"@rollup/plugin-node-resolve";import{terser}from"rollup-plugin-terser";import babel from"@rollup/plugin-babel";const license=require("rollup-plugin-license"),globby=require("globby"),fs=require("fs-extra");import postcss from"rollup-plugin-postcss";export default class Bundler{constructor(s,e){this.bundles=[],this.env=e,this.version="/* Tabulator v"+s+" (c) Oliver Folkerd <%= moment().format('YYYY') %> */"}bundle(){return this.env?this.watch(this.env):this.build(),this.bundles}watch(s){switch(s){case"css":this.bundleCSS(!1);break;case"esm":this.bundleESM(!1);break;case"umd":this.bundleUMD(!1);break;default:this.bundleCSS(!1),this.bundleESM(!1);break}}build(){this.clearDist(),this.copyStandaloneBuilds(),this.bundleCSS(!1),this.bundleCSS(!0),this.bundleESM(!1),this.bundleESM(!0),this.bundleUMD(!1),this.bundleUMD(!0)}clearDist(){fs.emptyDirSync("./dist")}copyStandaloneBuilds(){["jquery_wrapper.js"].forEach((s=>{fs.copySync("./src/js/builds/"+s,"./dist/js/"+s)}))}bundleCSS(s){this.bundles=this.bundles.concat(globby.sync("./src/scss/**/tabulator*.scss").map((e=>{var t=e.split("/");return{input:e,output:{file:"./dist/css/"+(t=t.pop().replace(".scss",(s?".min":"")+".css")),format:"es"},plugins:[postcss({modules:!1,extract:!0,minimize:s,sourceMap:!0,plugins:[require("postcss-prettify")]})]}})))}bundleESM(s){this.bundles.push({input:"src/js/builds/esm.js",plugins:[nodeResolve(),s?terser():null,license({banner:{commentStyle:"none",content:this.version}})],output:[{file:"dist/js/tabulator_esm"+(s?".min":"")+".js",format:"esm",exports:"named",sourcemap:!0}]})}bundleUMD(s){this.bundles.push({input:"src/js/builds/usd.js",plugins:[nodeResolve(),babel({babelHelpers:"bundled"}),s?terser():null,license({banner:{commentStyle:"none",content:this.version}})],output:{file:"dist/js/tabulator"+(s?".min":"")+".js",format:"umd",name:"Tabulator",esModule:!1,exports:"default",sourcemap:!0}})}}